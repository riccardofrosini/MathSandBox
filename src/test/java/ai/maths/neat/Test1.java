package ai.maths.neat;

import ai.maths.neat.neuralnetwork.GenomeSerializerDeserializer;
import ai.maths.neat.neuralnetwork.functions.GenomeEvaluator;
import ai.maths.neat.utils.NodeFunctionsCreator;
import ai.maths.tictactoe.TicTacToe;
import org.junit.Test;

public class Test1 {

    @Test
    public void test() {
        GenomeEvaluator geno = GenomeSerializerDeserializer.getEvaluatorFromJson("[{\"inputId\":0,\"id\":1,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":1,\"id\":2,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":2,\"id\":3,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":3,\"id\":4,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":4,\"id\":5,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":5,\"id\":6,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":6,\"id\":7,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":7,\"id\":8,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":8,\"id\":9,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":0,\"id\":10,\"type\":\"OUTPUT\",\"backConnections\":[{\"inNode\":1,\"outNode\":10,\"innovation\":100001,\"weight\":0.4593398823182656,\"enabled\":false},{\"inNode\":2,\"outNode\":10,\"innovation\":100002,\"weight\":0.42402855498988246,\"enabled\":false},{\"inNode\":3,\"outNode\":10,\"innovation\":100003,\"weight\":0.572203125093108,\"enabled\":false},{\"inNode\":4,\"outNode\":10,\"innovation\":100004,\"weight\":-0.20914300708154948,\"enabled\":false},{\"inNode\":5,\"outNode\":10,\"innovation\":100005,\"weight\":0.46449173973620606,\"enabled\":false},{\"inNode\":6,\"outNode\":10,\"innovation\":100006,\"weight\":0.3946157391984525,\"enabled\":false},{\"inNode\":7,\"outNode\":10,\"innovation\":100007,\"weight\":0.47745743427045245,\"enabled\":false},{\"inNode\":8,\"outNode\":10,\"innovation\":100008,\"weight\":0.3351069254319669,\"enabled\":false},{\"inNode\":9,\"outNode\":10,\"innovation\":100009,\"weight\":0.38788251979256366,\"enabled\":false},{\"inNode\":14,\"outNode\":10,\"innovation\":100014,\"weight\":0.4407249175532881,\"enabled\":false},{\"inNode\":17,\"outNode\":10,\"innovation\":100017,\"weight\":-0.8594418948938737,\"enabled\":false},{\"inNode\":110,\"outNode\":10,\"innovation\":100110,\"weight\":0.40206211129716046,\"enabled\":true},{\"inNode\":111,\"outNode\":10,\"innovation\":100111,\"weight\":0.216078543051269,\"enabled\":false}]},{\"inputId\":0,\"id\":14,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":1,\"outNode\":14,\"innovation\":140001,\"weight\":-0.4927592861922634,\"enabled\":false},{\"inNode\":2,\"outNode\":14,\"innovation\":140002,\"weight\":-0.9971052507329217,\"enabled\":false},{\"inNode\":3,\"outNode\":14,\"innovation\":140003,\"weight\":0.5306686016095199,\"enabled\":false},{\"inNode\":4,\"outNode\":14,\"innovation\":140004,\"weight\":-0.5526785053187449,\"enabled\":false},{\"inNode\":5,\"outNode\":14,\"innovation\":140005,\"weight\":0.8760972484692557,\"enabled\":false},{\"inNode\":6,\"outNode\":14,\"innovation\":140006,\"weight\":0.48822216241299915,\"enabled\":false},{\"inNode\":7,\"outNode\":14,\"innovation\":140007,\"weight\":0.5334288170671287,\"enabled\":false},{\"inNode\":8,\"outNode\":14,\"innovation\":140008,\"weight\":0.8534473757347045,\"enabled\":false},{\"inNode\":17,\"outNode\":14,\"innovation\":140017,\"weight\":-0.8323114656678365,\"enabled\":false},{\"inNode\":25,\"outNode\":14,\"innovation\":140025,\"weight\":-0.5648496446435232,\"enabled\":false}]},{\"inputId\":0,\"id\":110,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":1,\"outNode\":110,\"innovation\":1100001,\"weight\":-0.3624441230364825,\"enabled\":false},{\"inNode\":3,\"outNode\":110,\"innovation\":1100003,\"weight\":-0.026950435544698705,\"enabled\":true},{\"inNode\":5,\"outNode\":110,\"innovation\":1100005,\"weight\":0.6942407278094076,\"enabled\":true},{\"inNode\":7,\"outNode\":110,\"innovation\":1100007,\"weight\":-0.06434157268241075,\"enabled\":true}]},{\"inputId\":0,\"id\":111,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":1,\"outNode\":111,\"innovation\":1110001,\"weight\":0.34281231365836673,\"enabled\":false},{\"inNode\":2,\"outNode\":111,\"innovation\":1110002,\"weight\":-0.5499987195723213,\"enabled\":false},{\"inNode\":3,\"outNode\":111,\"innovation\":1110003,\"weight\":-0.20518202159722007,\"enabled\":false},{\"inNode\":6,\"outNode\":111,\"innovation\":1110006,\"weight\":-0.5876676675795377,\"enabled\":false},{\"inNode\":7,\"outNode\":111,\"innovation\":1110007,\"weight\":-0.16440312300939694,\"enabled\":false},{\"inNode\":8,\"outNode\":111,\"innovation\":1110008,\"weight\":-0.21399678264124306,\"enabled\":false}]},{\"inputId\":0,\"id\":17,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":1,\"outNode\":17,\"innovation\":170001,\"weight\":0.9999793699128312,\"enabled\":false},{\"inNode\":2,\"outNode\":17,\"innovation\":170002,\"weight\":0.06904061709713306,\"enabled\":false},{\"inNode\":3,\"outNode\":17,\"innovation\":170003,\"weight\":0.8879077198720166,\"enabled\":false},{\"inNode\":4,\"outNode\":17,\"innovation\":170004,\"weight\":0.21671132504618904,\"enabled\":false},{\"inNode\":6,\"outNode\":17,\"innovation\":170006,\"weight\":-0.7989451841958292,\"enabled\":false},{\"inNode\":7,\"outNode\":17,\"innovation\":170007,\"weight\":0.6606623168542964,\"enabled\":false},{\"inNode\":8,\"outNode\":17,\"innovation\":170008,\"weight\":0.5399009317805302,\"enabled\":false},{\"inNode\":9,\"outNode\":17,\"innovation\":170009,\"weight\":-0.26219398718278764,\"enabled\":false},{\"inNode\":25,\"outNode\":17,\"innovation\":170025,\"weight\":0.1989827710524659,\"enabled\":false},{\"inNode\":111,\"outNode\":17,\"innovation\":170111,\"weight\":-0.2017035883813043,\"enabled\":false}]},{\"inputId\":0,\"id\":25,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":1,\"outNode\":25,\"innovation\":250001,\"weight\":0.5352109444520214,\"enabled\":false},{\"inNode\":3,\"outNode\":25,\"innovation\":250003,\"weight\":0.9026528300069965,\"enabled\":false},{\"inNode\":5,\"outNode\":25,\"innovation\":250005,\"weight\":-0.7609707660867795,\"enabled\":false},{\"inNode\":6,\"outNode\":25,\"innovation\":250006,\"weight\":-0.8833940039577964,\"enabled\":false},{\"inNode\":7,\"outNode\":25,\"innovation\":250007,\"weight\":0.1278249004448626,\"enabled\":false},{\"inNode\":8,\"outNode\":25,\"innovation\":250008,\"weight\":-0.7416136652003803,\"enabled\":false},{\"inNode\":9,\"outNode\":25,\"innovation\":250009,\"weight\":0.4998633565594742,\"enabled\":false},{\"inNode\":111,\"outNode\":25,\"innovation\":250111,\"weight\":0.597367870486888,\"enabled\":false}]}]\n",
                NodeFunctionsCreator.linearUnit());
        TicTacToe ticTacToe = new TicTacToe();
        while (ticTacToe != null && !ticTacToe.getPossibleMoves().isEmpty()) {
            int[] board = ticTacToe.getBoard();
            int move = (int) Math.floor(geno.evaluateGenome(boardToDoubleInput(board)).get(0) * 9);
            ticTacToe = ticTacToe.makeMove(move);
            if (ticTacToe == null) break;
            System.out.println(ticTacToe);
            ticTacToe = ticTacToe.makeRandomMove();
            System.out.println(ticTacToe);
        }
        System.out.println(ticTacToe);
    }

    private static double[] boardToDoubleInput(int[] board) {
        double[] doubles = new double[board.length];
        for (int i = 0; i < board.length; i++) {
            doubles[i] = board[i] + 2;
        }
        return doubles;
    }
}
