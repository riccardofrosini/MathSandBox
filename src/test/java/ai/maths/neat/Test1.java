package ai.maths.neat;

import ai.maths.neat.neuralnetwork.GenomeSerializerDeserializer;
import ai.maths.neat.neuralnetwork.functions.GenomeEvaluator;
import ai.maths.neat.utils.NodeFunctionsCreator;
import ai.maths.tictactoe.TicTacToe;
import org.junit.Test;

public class Test1 {

    @Test
    public void test() {
        GenomeEvaluator geno = GenomeSerializerDeserializer.getEvaluatorFromJson("[{\"inputId\":0,\"id\":1,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":1,\"id\":2,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":2,\"id\":3,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":3,\"id\":4,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":4,\"id\":5,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":5,\"id\":6,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":6,\"id\":7,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":7,\"id\":8,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":8,\"id\":9,\"type\":\"INPUT\",\"backConnections\":[]},{\"inputId\":0,\"id\":10,\"type\":\"OUTPUT\",\"backConnections\":[{\"inNode\":1,\"outNode\":10,\"innovation\":100001,\"weight\":-0.6143866265909097,\"enabled\":false},{\"inNode\":2,\"outNode\":10,\"innovation\":100002,\"weight\":0.5350357532421074,\"enabled\":false},{\"inNode\":3,\"outNode\":10,\"innovation\":100003,\"weight\":0.46936588978983523,\"enabled\":false},{\"inNode\":4,\"outNode\":10,\"innovation\":100004,\"weight\":-0.22579983384719596,\"enabled\":false},{\"inNode\":5,\"outNode\":10,\"innovation\":100005,\"weight\":0.46449576539662524,\"enabled\":false},{\"inNode\":6,\"outNode\":10,\"innovation\":100006,\"weight\":0.34304786722241354,\"enabled\":false},{\"inNode\":7,\"outNode\":10,\"innovation\":100007,\"weight\":0.3691085876920493,\"enabled\":false},{\"inNode\":8,\"outNode\":10,\"innovation\":100008,\"weight\":-0.11248768679921185,\"enabled\":false},{\"inNode\":9,\"outNode\":10,\"innovation\":100009,\"weight\":-1.0,\"enabled\":false},{\"inNode\":12,\"outNode\":10,\"innovation\":100012,\"weight\":0.747454264134429,\"enabled\":false},{\"inNode\":18,\"outNode\":10,\"innovation\":100018,\"weight\":0.24873716929599737,\"enabled\":true},{\"inNode\":19,\"outNode\":10,\"innovation\":100019,\"weight\":0.16755570305522435,\"enabled\":false}]},{\"inputId\":0,\"id\":107,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":1,\"outNode\":107,\"innovation\":1070001,\"weight\":-0.666996125278565,\"enabled\":true},{\"inNode\":2,\"outNode\":107,\"innovation\":1070002,\"weight\":-0.7418148915007501,\"enabled\":true},{\"inNode\":8,\"outNode\":107,\"innovation\":1070008,\"weight\":0.7653631418979456,\"enabled\":true},{\"inNode\":9,\"outNode\":107,\"innovation\":1070009,\"weight\":0.4884471653348383,\"enabled\":true},{\"inNode\":23,\"outNode\":107,\"innovation\":1070023,\"weight\":-0.9201382611600905,\"enabled\":true},{\"inNode\":108,\"outNode\":107,\"innovation\":1070108,\"weight\":-0.01735787889409557,\"enabled\":true}]},{\"inputId\":0,\"id\":12,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":1,\"outNode\":12,\"innovation\":120001,\"weight\":0.0759808353442145,\"enabled\":false},{\"inNode\":2,\"outNode\":12,\"innovation\":120002,\"weight\":0.2664523585436993,\"enabled\":false},{\"inNode\":3,\"outNode\":12,\"innovation\":120003,\"weight\":-0.6108226807112827,\"enabled\":false},{\"inNode\":4,\"outNode\":12,\"innovation\":120004,\"weight\":-0.6361343033985863,\"enabled\":false},{\"inNode\":6,\"outNode\":12,\"innovation\":120006,\"weight\":-0.28546039692929426,\"enabled\":false},{\"inNode\":7,\"outNode\":12,\"innovation\":120007,\"weight\":-0.5532817845900976,\"enabled\":true},{\"inNode\":8,\"outNode\":12,\"innovation\":120008,\"weight\":0.5939397865233085,\"enabled\":false},{\"inNode\":18,\"outNode\":12,\"innovation\":120018,\"weight\":-0.7374261362548422,\"enabled\":true},{\"inNode\":23,\"outNode\":12,\"innovation\":120023,\"weight\":-0.46270332723092267,\"enabled\":false},{\"inNode\":51,\"outNode\":12,\"innovation\":120051,\"weight\":0.9423448521524307,\"enabled\":false},{\"inNode\":107,\"outNode\":12,\"innovation\":120107,\"weight\":-0.5031931635549886,\"enabled\":true},{\"inNode\":108,\"outNode\":12,\"innovation\":120108,\"weight\":-0.08876091616502771,\"enabled\":false}]},{\"inputId\":0,\"id\":108,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":2,\"outNode\":108,\"innovation\":1080002,\"weight\":-0.0741882014249132,\"enabled\":false},{\"inNode\":4,\"outNode\":108,\"innovation\":1080004,\"weight\":-0.9094933167389554,\"enabled\":false},{\"inNode\":8,\"outNode\":108,\"innovation\":1080008,\"weight\":-0.4481995896963562,\"enabled\":false},{\"inNode\":18,\"outNode\":108,\"innovation\":1080018,\"weight\":0.6524173897886973,\"enabled\":true}]},{\"inputId\":0,\"id\":77,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":3,\"outNode\":77,\"innovation\":770003,\"weight\":0.6534490244592521,\"enabled\":true},{\"inNode\":4,\"outNode\":77,\"innovation\":770004,\"weight\":-0.7371633433281325,\"enabled\":false},{\"inNode\":6,\"outNode\":77,\"innovation\":770006,\"weight\":0.8644456949016097,\"enabled\":false},{\"inNode\":7,\"outNode\":77,\"innovation\":770007,\"weight\":-0.3519562089980063,\"enabled\":true},{\"inNode\":9,\"outNode\":77,\"innovation\":770009,\"weight\":-0.5827210278579071,\"enabled\":false},{\"inNode\":51,\"outNode\":77,\"innovation\":770051,\"weight\":-0.8397175730726387,\"enabled\":true},{\"inNode\":108,\"outNode\":77,\"innovation\":770108,\"weight\":0.43529293511187217,\"enabled\":true}]},{\"inputId\":0,\"id\":18,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":5,\"outNode\":18,\"innovation\":180005,\"weight\":0.7976736650749415,\"enabled\":true},{\"inNode\":51,\"outNode\":18,\"innovation\":180051,\"weight\":-0.20603312974511565,\"enabled\":true}]},{\"inputId\":0,\"id\":19,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":1,\"outNode\":19,\"innovation\":190001,\"weight\":-0.9908764046140944,\"enabled\":false},{\"inNode\":2,\"outNode\":19,\"innovation\":190002,\"weight\":0.9076029015335553,\"enabled\":false},{\"inNode\":4,\"outNode\":19,\"innovation\":190004,\"weight\":-0.32286385147560953,\"enabled\":false},{\"inNode\":7,\"outNode\":19,\"innovation\":190007,\"weight\":-0.7794857004921526,\"enabled\":false},{\"inNode\":9,\"outNode\":19,\"innovation\":190009,\"weight\":0.5680486043045011,\"enabled\":true},{\"inNode\":12,\"outNode\":19,\"innovation\":190012,\"weight\":0.6539190142597262,\"enabled\":false},{\"inNode\":18,\"outNode\":19,\"innovation\":190018,\"weight\":0.7993063414700884,\"enabled\":true},{\"inNode\":25,\"outNode\":19,\"innovation\":190025,\"weight\":0.5185190369828395,\"enabled\":false},{\"inNode\":108,\"outNode\":19,\"innovation\":190108,\"weight\":-0.8066181429936001,\"enabled\":false}]},{\"inputId\":0,\"id\":51,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":1,\"outNode\":51,\"innovation\":510001,\"weight\":0.9071056787394646,\"enabled\":false},{\"inNode\":4,\"outNode\":51,\"innovation\":510004,\"weight\":-0.823790786586312,\"enabled\":false},{\"inNode\":7,\"outNode\":51,\"innovation\":510007,\"weight\":-0.9513118720047309,\"enabled\":true}]},{\"inputId\":0,\"id\":23,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":6,\"outNode\":23,\"innovation\":230006,\"weight\":-0.19623670319389427,\"enabled\":false},{\"inNode\":77,\"outNode\":23,\"innovation\":230077,\"weight\":-0.7547138298620754,\"enabled\":false},{\"inNode\":108,\"outNode\":23,\"innovation\":230108,\"weight\":-0.6581632155333708,\"enabled\":false}]},{\"inputId\":0,\"id\":25,\"type\":\"HIDDEN\",\"backConnections\":[{\"inNode\":1,\"outNode\":25,\"innovation\":250001,\"weight\":0.02487734735858904,\"enabled\":false},{\"inNode\":6,\"outNode\":25,\"innovation\":250006,\"weight\":-0.9420814586510391,\"enabled\":true}]}]\n",
                NodeFunctionsCreator.linearUnit());
        TicTacToe ticTacToe = new TicTacToe();
        while (ticTacToe != null && !ticTacToe.getPossibleMoves().isEmpty()) {
            int[] board = ticTacToe.getBoard();
            int move = (int) Math.floor(geno.evaluateGenome(boardToDoubleInput(board)).get(0) * 9);
            ticTacToe = ticTacToe.makeMove(move);
            if (ticTacToe == null) break;
            System.out.println(ticTacToe);
            ticTacToe = ticTacToe.makeRandomMove();
            System.out.println(ticTacToe);
        }
        System.out.println(ticTacToe);
    }

    private static double[] boardToDoubleInput(int[] board) {
        double[] doubles = new double[board.length];
        for (int i = 0; i < board.length; i++) {
            doubles[i] = board[i] + 2;
        }
        return doubles;
    }
}
